{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Renz-Lunci/Desktop/Rx/%20Technology/Repository/lakaw-socmed-Website/src/app/following/Following.tsx"],"sourcesContent":["\"use client\";\r\nimport React, { useCallback, useEffect, useRef, useState } from \"react\";\r\nimport useApiPost from \"../hooks/postData\";\r\nimport { UserNotFollowing, UserNotFollowingRecord } from \"../types/ResTypes\";\r\nimport { setUserId } from \"../store/Slice/UserIdHashtagIdSlice\";\r\nimport { useAppDispatch } from \"../utils/hooks\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { toast } from \"react-toastify\";\r\nimport Image from \"next/image\";\r\nimport Cookies from \"js-cookie\";\r\n\r\nfunction Following() {\r\n  const { postData, loading } = useApiPost();\r\n  const dispatch = useAppDispatch();\r\n  const router = useRouter();\r\n\r\n  const [users, setUsers] = useState<UserNotFollowingRecord[]>([]);\r\n  const [hasMore, setHasMore] = useState(true);\r\n  const [fetching, setFetching] = useState(false);\r\n\r\n  const pageRef = useRef(1);\r\n  const hasFetchedRef = useRef(false); // prevent multiple calls for page 1\r\n  const MyUserId = Number(Cookies.get(\"Reelboost_user_id\"));\r\n\r\n  // Fetch users not following (with socials)\r\n  const fetchPage = async (pageToFetch: number) => {\r\n    if (pageToFetch === 1 && hasFetchedRef.current) return;\r\n\r\n    setFetching(true);\r\n    try {\r\n      const response: UserNotFollowing = await postData(\r\n        \"/users/find-user-not-following\",\r\n        {\r\n          page: pageToFetch,\r\n        }\r\n      );\r\n\r\n      // inside fetchPage\r\n      if (response.status) {\r\n        const filteredRecords = response.data.Records.filter(\r\n          (user) => user.user_id !== MyUserId\r\n        ).filter((user) => user.user_name && user.user_name.trim() !== \"\");\r\n\r\n        // only append once\r\n        setUsers((prev) => [...prev, ...filteredRecords]);\r\n\r\n        const totalPages = response.data.Pagination.total_pages;\r\n        setHasMore(pageToFetch < totalPages);\r\n\r\n        if (pageToFetch === 1) hasFetchedRef.current = true;\r\n      }\r\n    } catch (error) {\r\n      toast.error(\"Failed to fetch users\");\r\n    } finally {\r\n      setFetching(false);\r\n    }\r\n  };\r\n\r\n  // Initial load\r\n  useEffect(() => {\r\n    fetchPage(1);\r\n    pageRef.current = 2;\r\n  }, []);\r\n\r\n  // Infinite scroll\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  // Infinite scroll - window-based\r\n  const handleScroll = useCallback(() => {\r\n    if (!hasMore || fetching) return;\r\n\r\n    const scrollTop = window.scrollY;\r\n    const windowHeight = window.innerHeight;\r\n    const fullHeight = document.documentElement.scrollHeight;\r\n\r\n    if (scrollTop + windowHeight >= fullHeight - 150) {\r\n      fetchPage(pageRef.current);\r\n      pageRef.current += 1;\r\n    }\r\n  }, [fetching, hasMore]);\r\n  useEffect(() => {\r\n    window.addEventListener(\"scroll\", handleScroll);\r\n    return () => window.removeEventListener(\"scroll\", handleScroll);\r\n  }, [handleScroll]);\r\n\r\n  useEffect(() => {\r\n    const container = containerRef.current;\r\n    if (!container) return;\r\n    container.addEventListener(\"scroll\", handleScroll);\r\n    return () => container.removeEventListener(\"scroll\", handleScroll);\r\n  }, [handleScroll]);\r\n\r\n  // Navigate to user profile\r\n  const handleUserRoute = (userId: number) => {\r\n    dispatch(setUserId(userId));\r\n    router.push(`/profile/${userId}`);\r\n  };\r\n\r\n  // Follow / Remove user\r\n  // inside handleFollow\r\n  const handleFollow = async (userId: number) => {\r\n    try {\r\n      const res = await postData(\"/follow/follow-unfollow\", {\r\n        user_id: userId,\r\n      });\r\n\r\n      if (res.status) {\r\n        toast.success(res.message);\r\n\r\n        // âœ… immediately remove followed user\r\n        setUsers((prev) => prev.filter((u) => u.user_id !== userId));\r\n      } else {\r\n        toast.error(res.message || \"Failed to follow user\");\r\n      }\r\n    } catch (error) {\r\n      toast.error(\"Something went wrong\");\r\n    }\r\n  };\r\n\r\n  // Shimmer for loading\r\n  const ShimmerCard = () => (\r\n    <div className=\"h-[320px] rounded-lg overflow-hidden bg-gray-300 animate-pulse relative\" />\r\n  );\r\n\r\n  return (\r\n    <div\r\n      ref={containerRef}\r\n      className=\"grid lg:grid-cols-3 md:grid-cols-2 gap-4 py-4 overflow-y-auto h-full\"\r\n    >\r\n      {loading && users.length === 0 ? (\r\n        Array.from({ length: 6 }).map((_, idx) => <ShimmerCard key={idx} />)\r\n      ) : users.length === 0 ? (\r\n        <div className=\"flex flex-col justify-center items-center py-72 col-span-full\">\r\n          <Image\r\n            src=\"/profile/NoReels.png\"\r\n            width={80}\r\n            height={80}\r\n            alt=\"no reels\"\r\n          />\r\n          <p className=\"text-dark text-[11px] text-center font-normal max-w-3xs\">\r\n            Begin your journey to become a Lakaw creator today\r\n          </p>\r\n        </div>\r\n      ) : (\r\n        users.map((user) => {\r\n          const firstSocial = user.Socials[0];\r\n          return (\r\n            <div\r\n              key={user.user_id}\r\n              className=\"relative rounded-lg overflow-hidden h-[320px] mx-4 bg-dark\"\r\n            >\r\n              {firstSocial && firstSocial.Media?.[0]?.media_location ? (\r\n                <video\r\n                  src={firstSocial.Media[0].media_location}\r\n                  className=\"h-full w-full object-cover\"\r\n                  playsInline\r\n                  autoPlay\r\n                  muted\r\n                  loop\r\n                />\r\n              ) : (\r\n                <div className=\"h-full w-full bg-dark\" />\r\n              )}\r\n\r\n              {/* Profile + Follow button */}\r\n              <div className=\"flex flex-col gap-2 items-center absolute bottom-3 w-full z-20\">\r\n                <div\r\n                  className=\"flex flex-col gap-2 place-items-center cursor-pointer\"\r\n                  onClick={() => handleUserRoute(user.user_id)}\r\n                >\r\n                  <Image\r\n                    src={user.profile_pic || \"/default-avatar.png\"}\r\n                    className=\"w-8 h-8 rounded-full border border-primary\"\r\n                    alt=\"profile\"\r\n                    width={20}\r\n                    height={20}\r\n                  />\r\n                  <h2 className=\"text-sm font-medium text-primary drop-shadow-[0_1px_2px_rgba(0,0,0,0.9)]\">\r\n                    {user.user_name.replace(\" \", \"\").toLowerCase()}\r\n                  </h2>\r\n                </div>\r\n\r\n                <button\r\n                  onClick={() => handleFollow(user.user_id)}\r\n                  className=\"cursor-pointer py-1.5 px-14 rounded-xl font-medium text-sm text-primary bg-main-green\"\r\n                >\r\n                  Follow\r\n                </button>\r\n              </div>\r\n            </div>\r\n          );\r\n        })\r\n      )}\r\n\r\n      {/* Next page shimmer */}\r\n      {fetching &&\r\n        users.length > 0 &&\r\n        Array.from({ length: 3 }).map((_, idx) => (\r\n          <ShimmerCard key={`next-${idx}`} />\r\n        ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Following;\r\n"],"names":[],"mappings":"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","debugId":null}}]
}